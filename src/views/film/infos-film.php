<?php

use parisecran\DBAL\Connector;
use parisecran\Entity\Film;
use parisecran\Entity\Reservation;
use parisecran\Entity\Comment;

session_start();

require_once __DIR__ . "/../../../vendor/autoload.php";

$dbh = new Connector();

$filmModel = new Film($dbh->dbConnector);

if (!empty($_GET["id_film"])) {
    $id_film = $_GET["id_film"];
    
    $film = $filmModel->selectFilmById($id_film);
    
    if ($film) {
        $schedulenModel = new Reservation($dbh->dbConnector);
        $commentModel = new Comment($dbh->dbConnector);
        
        $comments = $commentModel->selectCommentByIdFilm($id_film);
        $cinemas = $schedulenModel->getAllCinemas();

        // Formatage de la durée du film
        $filmDuration = new DateTime($film["duration"]);
        $formatedFilmDuration = $filmDuration->format('G\h i');

        $titlePage = "Film " . $film["title"];
    } else {
        header("Location: index-film.php");
    }
} else {
    header("Location: index-film.php");
}

if (isset($_SESSION['id'])) {
    $isUser = $_SESSION['id'];
}

require_once __DIR__ . "/../../../src/views/header.html.php";
?>
<main id="single-film">
    <div class="container-info-film">
        <div class="film">
            <img src="<?= "../../../public/images_film/" . $film['image'] ?>" alt="<?= $film["title"] ?>">
            <div class="film-info">
                <h1><?= $film["title"] ?? "Nom inconnu" ?></h1>
                <div class="film-rating">
                    <?php
                    if ($film['average'] != 0) {
                        for ($i = 0; $i < 5; $i++) {
                            if ($i < $film['average']) { ?>
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <g clip-path="url(#clip0_24_1239)">
                                        <path d="M7.99998 1.86667L10.1333 5.86667L15.2 6.66667L11.7333 9.86667L12.2666 14.6667L7.73332 12.5333L3.73332 14.6667L3.99998 9.86667L1.06665 6.4L5.59998 5.86667L7.99998 1.86667Z" fill="#FF0020" stroke="black" />
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M7.99971 0.5C8.13859 0.499911 8.27476 0.538382 8.39306 0.611125C8.51135 0.683869 8.60713 0.788029 8.66971 0.912L10.7337 5.006L15.3557 5.668C15.4951 5.68787 15.6261 5.74657 15.7336 5.83738C15.8412 5.92819 15.9211 6.04745 15.964 6.18151C16.007 6.31557 16.0114 6.45902 15.9767 6.59545C15.942 6.73189 15.8695 6.85579 15.7677 6.953L12.4327 10.133L13.2187 14.621C13.2427 14.7585 13.2279 14.9 13.1759 15.0295C13.1239 15.1591 13.0368 15.2715 12.9244 15.3543C12.8119 15.437 12.6786 15.4867 12.5395 15.4978C12.4003 15.5088 12.2608 15.4809 12.1367 15.417L7.99971 13.287L3.86271 15.417C3.7386 15.4809 3.59911 15.5088 3.45996 15.4978C3.32081 15.4867 3.18751 15.437 3.07507 15.3543C2.96263 15.2715 2.87551 15.1591 2.8235 15.0295C2.7715 14.9 2.75668 14.7585 2.78071 14.621L3.56671 10.132L0.231714 6.952C0.130177 6.85475 0.0580203 6.73092 0.023477 6.59463C-0.0110663 6.45834 -0.00660522 6.31509 0.0363513 6.18121C0.0793077 6.04734 0.15903 5.92824 0.266421 5.83749C0.373813 5.74675 0.504549 5.68802 0.643714 5.668L5.26571 5.006L7.32971 0.912C7.3923 0.788029 7.48808 0.683869 7.60637 0.611125C7.72467 0.538382 7.86084 0.499911 7.99971 0.5ZM7.99971 2.916L6.42971 6.03C6.37531 6.13797 6.29561 6.23118 6.19741 6.3017C6.0992 6.37222 5.98541 6.41795 5.86571 6.435L2.38571 6.933L4.89271 9.323C4.98181 9.40829 5.0485 9.51423 5.08688 9.63145C5.12525 9.74866 5.13413 9.87354 5.11271 9.995L4.51871 13.391L7.65671 11.775C7.76282 11.7204 7.8804 11.692 7.99971 11.692C8.11903 11.692 8.23661 11.7204 8.34272 11.775L11.4807 13.391L10.8857 9.995C10.8644 9.87345 10.8735 9.74853 10.912 9.63131C10.9506 9.51409 11.0174 9.40819 11.1067 9.323L13.6137 6.933L10.1337 6.435C10.0142 6.4178 9.90061 6.372 9.80259 6.30149C9.70457 6.23098 9.62503 6.13784 9.57071 6.03L7.99971 2.916Z" fill="#FF0020" />
                                    </g>
                                    <defs>
                                        <clipPath id="clip0_24_1239">
                                            <rect width="16" height="16" fill="white" />
                                        </clipPath>
                                    </defs>
                                </svg>
                            <?php  } else { ?>
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <g clip-path="url(#clip0_24_1243)">
                                        <path d="M7.99998 1.86667L10.1333 5.86667L15.2 6.66667L11.7333 9.86667L12.2666 14.6667L7.73332 12.5333L3.73332 14.6667L3.99998 9.86667L1.06665 6.4L5.59998 5.86667L7.99998 1.86667Z" fill="currentColor" stroke="black" />
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M7.99971 0.5C8.13859 0.499911 8.27476 0.538382 8.39306 0.611125C8.51135 0.683869 8.60713 0.788029 8.66971 0.912L10.7337 5.006L15.3557 5.668C15.4951 5.68787 15.6261 5.74657 15.7336 5.83738C15.8412 5.92819 15.9211 6.04745 15.964 6.18151C16.007 6.31557 16.0114 6.45902 15.9767 6.59545C15.942 6.73189 15.8695 6.85579 15.7677 6.953L12.4327 10.133L13.2187 14.621C13.2427 14.7585 13.2279 14.9 13.1759 15.0295C13.1239 15.1591 13.0368 15.2715 12.9244 15.3543C12.8119 15.437 12.6786 15.4867 12.5395 15.4978C12.4003 15.5088 12.2608 15.4809 12.1367 15.417L7.99971 13.287L3.86271 15.417C3.7386 15.4809 3.59911 15.5088 3.45996 15.4978C3.32081 15.4867 3.18751 15.437 3.07507 15.3543C2.96263 15.2715 2.87551 15.1591 2.8235 15.0295C2.7715 14.9 2.75668 14.7585 2.78071 14.621L3.56671 10.132L0.231714 6.952C0.130177 6.85475 0.0580203 6.73092 0.023477 6.59463C-0.0110663 6.45834 -0.00660522 6.31509 0.0363513 6.18121C0.0793077 6.04734 0.15903 5.92824 0.266421 5.83749C0.373813 5.74675 0.504549 5.68802 0.643714 5.668L5.26571 5.006L7.32971 0.912C7.3923 0.788029 7.48808 0.683869 7.60637 0.611125C7.72467 0.538382 7.86084 0.499911 7.99971 0.5ZM7.99971 2.916L6.42971 6.03C6.37531 6.13797 6.29561 6.23118 6.19741 6.3017C6.0992 6.37222 5.98541 6.41795 5.86571 6.435L2.38571 6.933L4.89271 9.323C4.98181 9.40829 5.0485 9.51423 5.08688 9.63145C5.12525 9.74866 5.13413 9.87354 5.11271 9.995L4.51871 13.391L7.65671 11.775C7.76282 11.7204 7.8804 11.692 7.99971 11.692C8.11903 11.692 8.23661 11.7204 8.34272 11.775L11.4807 13.391L10.8857 9.995C10.8644 9.87345 10.8735 9.74853 10.912 9.63131C10.9506 9.51409 11.0174 9.40819 11.1067 9.323L13.6137 6.933L10.1337 6.435C10.0142 6.4178 9.90061 6.372 9.80259 6.30149C9.70457 6.23098 9.62503 6.13784 9.57071 6.03L7.99971 2.916Z" fill="currentColor" />
                                    </g>
                                    <defs>
                                        <clipPath id="clip0_24_1243">
                                            <rect width="16" height="16" fill="white" />
                                        </clipPath>
                                    </defs>
                                </svg>
                        <?php  }
                        }
                    } else { ?>
                        <p>Ce film n'a pas encore reçu de note.</p>
                    <?php } ?>
                </div>
                <h3><?= $formatedFilmDuration ?>
                    <span><?= $film["genre"] ?? "pas de genre" ?></span>
                </h3>
                <h3>Réalisé par :
                    <span id="realisator"><?= $film['realisateur'] ?></span>
                </h3>
                <h3>Avec : <span><?= $film['acteurs'] ?></span></h3>
                <h3>Synopsis :</h3>
                <div class="synopsis">
                    <p><?= $film["synopsis"] ?></p>
                </div>
            </div>
        </div>
        <div class="film-reservation">
            <form action="" method="post" id="reservation-form">

                <select name="cinema" id="select-cinema">
                    <option name="cinema" value="" selected disabled>Sélectionner un cinéma</option>
                    <?php foreach ($cinemas as $cinema) { ?>
                        <option value="<?= $cinema['id'] ?>"><?= $cinema['name'] ?></option>
                    <?php } ?>
                </select>
                <div class="reservation-container">
                    <div class="input-container" id="date-container">
                        <div class="reservation-invitation">
                            <svg fill="#ff0020" height="200px" width="200px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512.001 512.001" xml:space="preserve">
                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                <g id="SVGRepo_iconCarrier">
                                    <g>
                                        <g>
                                            <path d="M504.397,0.042H125.783c-4.199,0-7.603,3.404-7.603,7.603c0,4.199,3.404,7.603,7.603,7.603h371.011v163.711H15.802V15.247 h45.611c4.199,0,7.603-3.404,7.603-7.603c0-4.199-3.404-7.603-7.603-7.603H8.199C4,0.042,0.596,3.446,0.596,7.644v175.959 C0.213,184.512,0,185.511,0,186.559v81.102v134.822v101.874c0,4.199,3.404,7.603,7.603,7.603h124.893h55.754h134.315h55.754 h126.079c4.199,0,7.603-3.404,7.603-7.603V402.484V267.662V186.56V7.644C512,3.446,508.596,0.042,504.397,0.042z M15.206,275.264 h64.367v119.617H15.206V275.264z M124.895,496.755h-0.001H15.206v-86.668h71.97c4.199,0,7.603-3.404,7.603-7.603V267.662 c0-4.199-3.404-7.603-7.603-7.603h-71.97v-65.897H193.68c-5.226,2.793-10.295,5.935-15.16,9.465 c-3.399,2.466-4.154,7.221-1.689,10.619s7.22,4.154,10.619,1.689c19.628-14.243,42.867-21.772,67.202-21.772 c60.61,0,110.369,47.318,114.296,106.952h-39.17c-3.842-37.554-35.655-66.949-74.206-66.949 c-38.551,0-70.365,29.395-74.206,66.949h-41.011c1.224-18.516,6.897-36.44,16.602-52.246c2.197-3.578,1.078-8.26-2.501-10.457 c-3.578-2.197-8.26-1.078-10.457,2.501c-11.175,18.2-17.623,38.873-18.867,60.203h-9.36c-4.199,0-7.603,3.404-7.603,7.603v34.466 c0,4.199,3.404,7.603,7.603,7.603h9.123V496.755z M304.571,350.785h10.39v119.617h-51.787V249.874 c26.662,3.424,47.834,24.584,51.279,51.239h-9.882c-4.199,0-7.603,3.404-7.603,7.603v34.466 C296.968,347.381,300.372,350.785,304.571,350.785z M207.51,301.114h-10.82c3.445-26.656,24.617-47.815,51.279-51.239v220.528 h-52.116V350.785h11.658c4.199,0,7.603-3.404,7.603-7.603v-34.466C215.112,304.518,211.708,301.114,207.51,301.114z M180.647,478.005v18.75h-40.548v-145.97h40.548V478.005z M188.249,335.58h-55.753h-9.123v-19.26h64.393 c0.267,0.028,0.537,0.045,0.812,0.045c0.275,0,0.545-0.016,0.812-0.045h10.517v19.26H188.249z M314.962,496.755h-119.11v-11.148 h119.11V496.755z M370.715,496.755h-40.548v-18.75v-127.22h40.548V496.755z M322.565,335.58h-10.39v-19.26h9.578 c0.267,0.028,0.537,0.045,0.812,0.045s0.545-0.016,0.812-0.045h65.332v19.26h-10.39H322.565z M496.794,394.881h-64.367V275.264 h64.367V394.881z M496.794,260.059h-71.97c-4.199,0-7.603,3.404-7.603,7.603v134.822c0,4.199,3.404,7.603,7.603,7.603h71.97 v86.668H385.921v-145.97h10.39c4.199,0,7.603-3.404,7.603-7.603v-34.466c0-4.199-3.404-7.603-7.603-7.603h-12.128 c-2.691-46.339-29.808-86.227-68.637-106.952h181.248V260.059z"></path>
                                        </g>
                                    </g>
                                    <g>
                                        <g>
                                            <path d="M394.921,33.497H107.03c-4.199,0-7.603,3.404-7.603,7.603s3.404,7.603,7.603,7.603h287.891 c4.199,0,7.603-3.404,7.603-7.603C402.523,36.901,399.119,33.497,394.921,33.497z"></path>
                                        </g>
                                    </g>
                                    <g>
                                        <g>
                                            <path d="M394.921,145.511H107.03c-4.199,0-7.603,3.404-7.603,7.603s3.404,7.603,7.603,7.603h287.891 c4.199,0,7.603-3.404,7.603-7.603S399.119,145.511,394.921,145.511z"></path>
                                        </g>
                                    </g>
                                    <g>
                                        <g>
                                            <path d="M147.584,107.09c-3.151,0-5.745,0.927-5.93,3.799c-0.278,3.892-1.019,9.915-9.452,9.915 c-6.393,0-9.915-3.428-9.915-10.656V84.295c0-7.229,3.521-10.657,9.729-10.657c8.803,0,9.452,6.301,9.635,9.174 c0.093,2.781,2.595,3.799,6.023,3.799c4.077,0,6.023-1.112,6.023-5.93c0-10.75-9.174-17.607-22.054-17.607 c-11.676,0-21.405,5.746-21.405,21.221v25.853c0,15.474,9.637,21.22,21.313,21.22c12.973,0,22.147-7.135,22.147-18.348 C153.699,108.295,151.753,107.09,147.584,107.09z"></path>
                                        </g>
                                    </g>
                                    <g>
                                        <g>
                                            <path d="M167.875,63.076c-3.058,0-6.023,1.112-6.023,3.706v60.233c0,2.502,2.966,3.799,6.023,3.799 c2.965,0,6.023-1.298,6.023-3.799V66.782C173.898,64.188,170.84,63.076,167.875,63.076z"></path>
                                        </g>
                                    </g>
                                    <g>
                                        <g>
                                            <path d="M223.937,63.076c-3.058,0-6.023,1.112-6.023,3.706v37.251l-17.885-34.564c-2.873-5.468-4.633-6.394-8.988-6.394 c-3.058,0-6.023,1.204-6.023,3.799v60.14c0,2.502,2.966,3.799,6.023,3.799c2.965,0,6.023-1.298,6.023-3.799V89.762l19.923,37.251 c1.575,2.873,4.077,3.799,6.95,3.8c2.965,0,6.023-1.298,6.023-3.799V66.782C229.96,64.188,226.902,63.076,223.937,63.076z"></path>
                                        </g>
                                    </g>
                                    <g>
                                        <g>
                                            <path d="M279.349,120.25h-26.224v-18.626h14.085c2.595,0,3.799-2.502,3.799-4.634c0-2.502-1.39-4.819-3.799-4.819h-14.085V73.638 h26.224c2.41,0,3.799-2.502,3.799-5.375c0-2.502-1.204-5.189-3.799-5.189H246.36c-2.688,0-5.282,1.298-5.282,3.799v60.141 c0,2.502,2.595,3.799,5.282,3.799h32.989c2.595,0,3.799-2.686,3.799-5.189C283.148,122.752,281.758,120.25,279.349,120.25z"></path>
                                        </g>
                                    </g>
                                    <g>
                                        <g>
                                            <path d="M337.819,63.074c-4.355,0-6.393,0.927-9.452,6.394l-11.398,20.758l-11.398-20.758c-3.058-5.468-5.004-6.394-9.359-6.394 c-3.058,0-6.023,1.575-6.023,6.023v57.917c0,2.502,2.966,3.799,6.023,3.799c2.965,0,6.023-1.298,6.023-3.799V86.427l10.657,20.016 c1.02,1.853,2.503,2.41,3.985,2.41s3.057-0.557,4.077-2.41l10.842-19.275v39.846c0,2.502,2.965,3.799,6.023,3.799 c2.966,0,6.023-1.298,6.023-3.799V69.098C343.842,64.65,340.876,63.074,337.819,63.074z"></path>
                                        </g>
                                    </g>
                                    <g>
                                        <g>
                                            <path d="M401.663,124.883l-17.885-58.287c-0.834-2.78-4.263-4.077-7.784-4.077c-3.428,0-6.857,1.298-7.691,4.077l-17.885,58.287 c-0.092,0.37-0.186,0.741-0.186,0.927c0,2.965,4.356,5.004,7.599,5.004c2.039,0,3.614-0.649,4.077-2.41l3.522-12.325h21.221 l3.522,12.325c0.463,1.761,2.039,2.41,4.077,2.41c3.244,0,7.599-2.131,7.599-5.004 C401.848,125.532,401.756,125.254,401.663,124.883z M367.932,106.627l8.062-28.448l8.062,28.448H367.932z"></path>
                                        </g>
                                    </g>
                                </g>
                            </svg>
                            <h5>Nos cinéma sont prêt à vous accueillir</h5>
                            <div class="cinema-feature-container">

                                <div class="cinema-feature">
                                    <svg fill="#ff0020" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="40" height="40">
                                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                        <g id="SVGRepo_iconCarrier">
                                            <circle cx="9" cy="4" r="2"></circle>
                                            <path d="M16.98 14.804A1 1 0 0 0 16 14h-4.133l-.429-3H16V9h-4.847l-.163-1.142A1 1 0 0 0 10 7H9a1.003 1.003 0 0 0-.99 1.142l.877 6.142A2.009 2.009 0 0 0 10.867 16h4.313l.839 4.196c.094.467.504.804.981.804h3v-2h-2.181l-.839-4.196z"></path>
                                            <path d="M12.51 17.5c-.739 1.476-2.25 2.5-4.01 2.5A4.505 4.505 0 0 1 4 15.5a4.503 4.503 0 0 1 2.817-4.167l-.289-2.025C3.905 10.145 2 12.604 2 15.5 2 19.084 4.916 22 8.5 22a6.497 6.497 0 0 0 5.545-3.126l-.274-1.374H12.51z"></path>
                                        </g>
                                    </svg>
                                    <span>Accès PMR</span>
                                </div>
                                <div class="cinema-feature">
                                    <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="none" width="40" height="40">
                                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                        <g id="SVGRepo_iconCarrier">
                                            <g fill="#ff0020">
                                                <path d="M1.443 5.978a9.917 9.917 0 0113.114 0 .75.75 0 00.992-1.126 11.417 11.417 0 00-15.098 0 .75.75 0 10.992 1.126z"></path>
                                                <path d="M3.813 8.525a6.583 6.583 0 018.427 0 .75.75 0 00.96-1.153 8.083 8.083 0 00-10.347 0 .75.75 0 00.96 1.153z"></path>
                                                <path d="M8.003 10.5a3.25 3.25 0 00-1.882.6.75.75 0 01-.869-1.222 4.75 4.75 0 015.502 0 .75.75 0 11-.868 1.223 3.25 3.25 0 00-1.883-.601zM8 12a1 1 0 100 2h.007a1 1 0 100-2H8z"></path>
                                            </g>
                                        </g>
                                    </svg>
                                    <span>Wifi Gratuit</span>
                                </div>
                                <div class="cinema-feature">
                                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="40" height="40">
                                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                        <g id="SVGRepo_iconCarrier">
                                            <path d="M17.5 7L16.3277 19.1914C16.2291 20.2171 15.3673 21 14.3369 21H9.66307C8.63265 21 7.77088 20.2171 7.67225 19.1914L6.5 7M12 7V3.5L15.5 2.5M5 7H19" stroke="#ff0020" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                        </g>
                                    </svg>
                                    <span>Restauration</span>
                                </div>
                                <div class="cinema-feature">
                                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#ff0020" width="40" height="40">
                                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                        <g id="SVGRepo_iconCarrier">
                                            <g>
                                                <path fill="none" d="M0 0h24v24H0z"></path>
                                                <path d="M11 14h1.5a3.5 3.5 0 0 0 0-7H9v10h2v-3zM4 3h16a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zm7 6h1.5a1.5 1.5 0 0 1 0 3H11V9z"></path>
                                            </g>
                                        </g>
                                    </svg>
                                    <span>Parking</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="reservation-container">
                    <div class="input-container" id="hour-container"></div>
                </div>
                <button type="submit" class="hide"><svg width="33" height="32" viewBox="0 0 33 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18.03 4.113C18.316 3.827 18.703 3.667 19.108 3.667C19.513 3.667 19.9 3.827 20.186 4.113L22.352 6.282C22.623 6.552 22.782 6.915 22.798 7.297C22.814 7.681 22.684 8.057 22.435 8.349L22.433 8.352C22.276 8.536 22.193 8.772 22.202 9.014C22.211 9.256 22.311 9.484 22.481 9.655C22.652 9.825 22.881 9.925 23.123 9.933C23.365 9.941 23.601 9.859 23.784 9.701L23.788 9.697C24.08 9.448 24.456 9.318 24.84 9.334C25.223 9.35 25.585 9.51 25.855 9.781L25.858 9.784L28.021 11.947C28.307 12.233 28.468 12.621 28.468 13.025C28.468 13.429 28.307 13.817 28.022 14.103L24.568 17.557C24.315 17.81 24.01 18.006 23.675 18.131C23.55 18.467 23.355 18.773 23.101 19.028L14.241 27.887C13.955 28.173 13.567 28.333 13.163 28.333C12.759 28.333 12.371 28.172 12.085 27.887L9.91898 25.721C9.64798 25.451 9.48798 25.088 9.47198 24.706C9.45598 24.322 9.58598 23.946 9.83498 23.654L9.83798 23.651C9.99598 23.467 10.078 23.231 10.069 22.99C10.06 22.749 9.95998 22.519 9.78898 22.348C9.61798 22.177 9.38898 22.077 9.14698 22.068C8.90498 22.059 8.66898 22.141 8.48498 22.299L8.48198 22.302C8.18998 22.551 7.81398 22.681 7.42998 22.665C7.04698 22.649 6.68498 22.489 6.41498 22.218L6.41198 22.215L4.24898 20.052C3.96298 19.766 3.80298 19.378 3.80298 18.974C3.80298 18.57 3.96298 18.182 4.24898 17.896L13.108 9.039C13.361 8.786 13.667 8.59 14.002 8.465C14.127 8.128 14.323 7.822 14.577 7.568L18.03 4.113ZM13.973 8.543L14.134 8.597L14.135 8.599L13.972 8.545L13.973 8.543ZM14.137 8.599L14.136 8.597L15.238 8.964L14.137 8.599ZM14.504 9.701L14.871 10.803L14.874 10.806L14.504 9.701ZM14.875 10.807L14.872 10.804L14.926 10.965L14.928 10.964L14.875 10.807ZM14.964 10.952L6.94198 18.972L7.66798 19.698C8.16198 19.484 8.70098 19.38 9.24798 19.401C10.162 19.436 11.028 19.814 11.675 20.46C12.322 21.106 12.7 21.973 12.734 22.887C12.755 23.434 12.651 23.974 12.437 24.467L13.163 25.193L21.185 17.171C21.308 16.819 21.509 16.499 21.773 16.235C22.037 15.971 22.358 15.768 22.711 15.643L25.329 13.025L24.604 12.3C24.111 12.514 23.572 12.618 23.026 12.598C22.113 12.565 21.246 12.188 20.599 11.543L21.54 10.598L20.597 11.541C19.951 10.895 19.573 10.028 19.538 9.115C19.517 8.568 19.62 8.028 19.835 7.534L19.108 6.806L16.49 9.424C16.367 9.776 16.166 10.095 15.903 10.36C15.638 10.625 15.318 10.828 14.965 10.952H14.964ZM22.748 15.63L23.171 16.894L22.75 15.629L22.748 15.63ZM23.538 17.996L22.437 17.631L23.539 17.998L23.538 17.996ZM23.541 17.999L23.54 17.996L23.703 18.05L23.702 18.052L23.541 17.999Z" fill="white" />
                        <path d="M14.5829 9.043C14.8429 8.783 15.2649 8.783 15.5259 9.043L16.3369 9.854C16.5969 10.114 16.5969 10.536 16.3369 10.797C16.0769 11.058 15.6549 11.057 15.3939 10.797L14.5829 9.986C14.3229 9.726 14.3229 9.304 14.5829 9.043ZM17.0149 11.475C17.2749 11.215 17.6969 11.214 17.9579 11.475L18.4989 12.015C18.7589 12.275 18.7599 12.697 18.4989 12.958C18.2379 13.219 17.8169 13.219 17.5559 12.958L17.0149 12.418C16.7539 12.158 16.7539 11.736 17.0149 11.475ZM19.1769 13.637C19.4369 13.377 19.8599 13.377 20.1199 13.637L20.6599 14.178C20.9199 14.438 20.9199 14.861 20.6599 15.121C20.3999 15.381 19.9769 15.381 19.7169 15.121L19.1769 14.58C18.9169 14.319 18.9169 13.897 19.1769 13.637ZM21.3389 15.799C21.5989 15.539 22.0219 15.539 22.2819 15.799L23.0929 16.61C23.3529 16.87 23.3529 17.292 23.0929 17.553C22.8329 17.814 22.4109 17.813 22.1499 17.553L21.3389 16.742C21.0789 16.482 21.0789 16.06 21.3389 15.799Z" fill="white" />
                    </svg>
                    Réserver ma séance</button>
            </form>
        </div>
    </div>
    <section class="comments">
        <h2>Critiques des spectateurs</h2>
        <?php
        if ($comments) {
            foreach ($comments as $comment) {
                $reactions = json_decode($comment['reactions'], true);
        ?>
                <div class="comment">
                    <h4><?= $comment['first_name'] . " " . $comment['last_name'] ?></h4>
                    <div class="comment-rating">
                        <?php for ($i = 0; $i < 5; $i++) {
                            if ($i < $comment['notation']) { ?>
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <g clip-path="url(#clip0_24_1239)">
                                        <path d="M7.99998 1.86667L10.1333 5.86667L15.2 6.66667L11.7333 9.86667L12.2666 14.6667L7.73332 12.5333L3.73332 14.6667L3.99998 9.86667L1.06665 6.4L5.59998 5.86667L7.99998 1.86667Z" fill="#FF0020" stroke="black" />
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M7.99971 0.5C8.13859 0.499911 8.27476 0.538382 8.39306 0.611125C8.51135 0.683869 8.60713 0.788029 8.66971 0.912L10.7337 5.006L15.3557 5.668C15.4951 5.68787 15.6261 5.74657 15.7336 5.83738C15.8412 5.92819 15.9211 6.04745 15.964 6.18151C16.007 6.31557 16.0114 6.45902 15.9767 6.59545C15.942 6.73189 15.8695 6.85579 15.7677 6.953L12.4327 10.133L13.2187 14.621C13.2427 14.7585 13.2279 14.9 13.1759 15.0295C13.1239 15.1591 13.0368 15.2715 12.9244 15.3543C12.8119 15.437 12.6786 15.4867 12.5395 15.4978C12.4003 15.5088 12.2608 15.4809 12.1367 15.417L7.99971 13.287L3.86271 15.417C3.7386 15.4809 3.59911 15.5088 3.45996 15.4978C3.32081 15.4867 3.18751 15.437 3.07507 15.3543C2.96263 15.2715 2.87551 15.1591 2.8235 15.0295C2.7715 14.9 2.75668 14.7585 2.78071 14.621L3.56671 10.132L0.231714 6.952C0.130177 6.85475 0.0580203 6.73092 0.023477 6.59463C-0.0110663 6.45834 -0.00660522 6.31509 0.0363513 6.18121C0.0793077 6.04734 0.15903 5.92824 0.266421 5.83749C0.373813 5.74675 0.504549 5.68802 0.643714 5.668L5.26571 5.006L7.32971 0.912C7.3923 0.788029 7.48808 0.683869 7.60637 0.611125C7.72467 0.538382 7.86084 0.499911 7.99971 0.5ZM7.99971 2.916L6.42971 6.03C6.37531 6.13797 6.29561 6.23118 6.19741 6.3017C6.0992 6.37222 5.98541 6.41795 5.86571 6.435L2.38571 6.933L4.89271 9.323C4.98181 9.40829 5.0485 9.51423 5.08688 9.63145C5.12525 9.74866 5.13413 9.87354 5.11271 9.995L4.51871 13.391L7.65671 11.775C7.76282 11.7204 7.8804 11.692 7.99971 11.692C8.11903 11.692 8.23661 11.7204 8.34272 11.775L11.4807 13.391L10.8857 9.995C10.8644 9.87345 10.8735 9.74853 10.912 9.63131C10.9506 9.51409 11.0174 9.40819 11.1067 9.323L13.6137 6.933L10.1337 6.435C10.0142 6.4178 9.90061 6.372 9.80259 6.30149C9.70457 6.23098 9.62503 6.13784 9.57071 6.03L7.99971 2.916Z" fill="#FF0020" />
                                    </g>
                                    <defs>
                                        <clipPath id="clip0_24_1239">
                                            <rect width="16" height="16" fill="white" />
                                        </clipPath>
                                    </defs>
                                </svg>
                            <?php  } else { ?>
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <g clip-path="url(#clip0_24_1243)">
                                        <path d="M7.99998 1.86667L10.1333 5.86667L15.2 6.66667L11.7333 9.86667L12.2666 14.6667L7.73332 12.5333L3.73332 14.6667L3.99998 9.86667L1.06665 6.4L5.59998 5.86667L7.99998 1.86667Z" fill="#8D8D8D" stroke="black" />
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M7.99971 0.5C8.13859 0.499911 8.27476 0.538382 8.39306 0.611125C8.51135 0.683869 8.60713 0.788029 8.66971 0.912L10.7337 5.006L15.3557 5.668C15.4951 5.68787 15.6261 5.74657 15.7336 5.83738C15.8412 5.92819 15.9211 6.04745 15.964 6.18151C16.007 6.31557 16.0114 6.45902 15.9767 6.59545C15.942 6.73189 15.8695 6.85579 15.7677 6.953L12.4327 10.133L13.2187 14.621C13.2427 14.7585 13.2279 14.9 13.1759 15.0295C13.1239 15.1591 13.0368 15.2715 12.9244 15.3543C12.8119 15.437 12.6786 15.4867 12.5395 15.4978C12.4003 15.5088 12.2608 15.4809 12.1367 15.417L7.99971 13.287L3.86271 15.417C3.7386 15.4809 3.59911 15.5088 3.45996 15.4978C3.32081 15.4867 3.18751 15.437 3.07507 15.3543C2.96263 15.2715 2.87551 15.1591 2.8235 15.0295C2.7715 14.9 2.75668 14.7585 2.78071 14.621L3.56671 10.132L0.231714 6.952C0.130177 6.85475 0.0580203 6.73092 0.023477 6.59463C-0.0110663 6.45834 -0.00660522 6.31509 0.0363513 6.18121C0.0793077 6.04734 0.15903 5.92824 0.266421 5.83749C0.373813 5.74675 0.504549 5.68802 0.643714 5.668L5.26571 5.006L7.32971 0.912C7.3923 0.788029 7.48808 0.683869 7.60637 0.611125C7.72467 0.538382 7.86084 0.499911 7.99971 0.5ZM7.99971 2.916L6.42971 6.03C6.37531 6.13797 6.29561 6.23118 6.19741 6.3017C6.0992 6.37222 5.98541 6.41795 5.86571 6.435L2.38571 6.933L4.89271 9.323C4.98181 9.40829 5.0485 9.51423 5.08688 9.63145C5.12525 9.74866 5.13413 9.87354 5.11271 9.995L4.51871 13.391L7.65671 11.775C7.76282 11.7204 7.8804 11.692 7.99971 11.692C8.11903 11.692 8.23661 11.7204 8.34272 11.775L11.4807 13.391L10.8857 9.995C10.8644 9.87345 10.8735 9.74853 10.912 9.63131C10.9506 9.51409 11.0174 9.40819 11.1067 9.323L13.6137 6.933L10.1337 6.435C10.0142 6.4178 9.90061 6.372 9.80259 6.30149C9.70457 6.23098 9.62503 6.13784 9.57071 6.03L7.99971 2.916Z" fill="#8D8D8D" />
                                    </g>
                                    <defs>
                                        <clipPath id="clip0_24_1243">
                                            <rect width="16" height="16" fill="white" />
                                        </clipPath>
                                    </defs>
                                </svg>
                        <?php  }
                        } ?>
                    </div>

                    <p><?= $comment['comment'] ?></p>
                    <section class="comment-reactions">
                        <div class="comment-reaction">

                            <div class="comment-reaction">
                                <span><?= count($reactions['like']) ?? 0 ?></span><?php  ?>
                                <button type="submit" name="reaction" value="like" data-comment-id="<?= $comment['comment_id'] ?>">
                                    <svg class="react-svg-gray 
                                    <?php if (isset($isUser)) {
                                        if (in_array($isUser, $reactions['like'])) {
                                            echo "react-svg-red";
                                        }
                                    } ?>" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M13.2499 3.75002C13.2499 2.50002 12.0149 1.66669 11.0499 1.66669C10.3783 1.66669 10.3258 2.17669 10.2224 3.18335C10.1766 3.62502 10.1216 4.16169 9.99992 4.79169C9.67825 6.46002 8.56659 8.59169 7.50325 9.22919V14.1667C7.49992 16.0417 8.12492 16.6667 10.8333 16.6667H13.9774C15.7908 16.6667 16.2299 15.4725 16.3933 15.03L16.4041 15C16.4991 14.745 16.7024 14.5442 16.9358 14.3167C17.1941 14.0617 17.4891 13.7725 17.7083 13.3334C17.9674 12.8142 17.9333 12.3525 17.9024 11.9417C17.8833 11.6925 17.8658 11.4625 17.9166 11.25C17.9699 11.025 18.0383 10.8542 18.1041 10.6909C18.2233 10.3942 18.3333 10.1192 18.3333 9.58335C18.3333 8.33335 17.7099 7.50169 16.4041 7.50169H12.9166C12.9166 7.50169 13.2499 5.00002 13.2499 3.75002ZM4.58325 8.33335C4.25173 8.33335 3.93379 8.46505 3.69937 8.69947C3.46495 8.93389 3.33325 9.25183 3.33325 9.58335V15.4167C3.33325 15.7482 3.46495 16.0661 3.69937 16.3006C3.93379 16.535 4.25173 16.6667 4.58325 16.6667C4.91477 16.6667 5.23272 16.535 5.46714 16.3006C5.70156 16.0661 5.83325 15.7482 5.83325 15.4167V9.58335C5.83325 9.25183 5.70156 8.93389 5.46714 8.69947C5.23272 8.46505 4.91477 8.33335 4.58325 8.33335Z" fill="currentColor" />
                                    </svg>
                                </button>
                            </div>
                            <div class="comment-reaction">
                                <span><?= count($reactions['dislikes']) ?? 0 ?></span>
                                <button type="submit" name="reaction" value="dislikes" data-comment-id="<?= $comment['comment_id'] ?>">
                                    <svg class="react-svg-gray 
                                    <?php if (isset($isUser)) {
                                        if (in_array($isUser, $reactions['dislikes'])) {
                                            echo "react-svg-red";
                                        }
                                    } ?>" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M13.2499 16.25C13.2499 17.5 12.0149 18.3333 11.0499 18.3333C10.3783 18.3333 10.3258 17.8233 10.2224 16.8167C10.1766 16.375 10.1216 15.8383 9.99992 15.2083C9.67825 13.54 8.56659 11.4083 7.50325 10.7708V5.83334C7.49992 3.95834 8.12492 3.33334 10.8333 3.33334H13.9774C15.7908 3.33334 16.2299 4.52751 16.3933 4.97001L16.4041 5.00001C16.4991 5.25501 16.7024 5.45584 16.9358 5.68334C17.1941 5.93834 17.4891 6.22751 17.7083 6.66668C17.9674 7.18584 17.9333 7.64751 17.9024 8.05834C17.8833 8.30751 17.8658 8.53751 17.9166 8.75001C17.9699 8.97501 18.0383 9.14584 18.1041 9.30918C18.2233 9.60584 18.3333 9.88084 18.3333 10.4167C18.3333 11.6667 17.7099 12.4983 16.4041 12.4983H12.9166C12.9166 12.4983 13.2499 15 13.2499 16.25ZM4.58325 11.6667C4.25173 11.6667 3.93379 11.535 3.69937 11.3006C3.46495 11.0661 3.33325 10.7482 3.33325 10.4167V4.58334C3.33325 4.25182 3.46495 3.93388 3.69937 3.69946C3.93379 3.46504 4.25173 3.33334 4.58325 3.33334C4.91477 3.33334 5.23272 3.46504 5.46714 3.69946C5.70156 3.93388 5.83325 4.25182 5.83325 4.58334V10.4167C5.83325 10.7482 5.70156 11.0661 5.46714 11.3006C5.23272 11.535 4.91477 11.6667 4.58325 11.6667Z" fill="currentColor" />
                                    </svg>
                                </button>
                            </div>
                            <div class="comment-reaction">
                                <span><?= count($reactions['surprised']) ?? 0 ?></span>
                                <button type="submit" name="reaction" value="surprised" data-comment-id="<?= $comment['comment_id'] ?>">
                                    <svg class="react-svg-gray 
                                    <?php if (isset($isUser)) {
                                        if (in_array($isUser, $reactions['surprised'])) {
                                            echo "react-svg-red";
                                        }
                                    } ?>" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_23_149)">
                                            <path d="M7.08325 9.16666C7.77361 9.16666 8.33325 8.60699 8.33325 7.91666C8.33325 7.2263 7.77361 6.66666 7.08325 6.66666C6.39289 6.66666 5.83325 7.2263 5.83325 7.91666C5.83325 8.60699 6.39289 9.16666 7.08325 9.16666Z" fill="currentColor" />
                                            <path d="M14.1667 7.91666C14.1667 8.60699 13.6071 9.16666 12.9167 9.16666C12.2264 9.16666 11.6667 8.60699 11.6667 7.91666C11.6667 7.2263 12.2264 6.66666 12.9167 6.66666C13.6071 6.66666 14.1667 7.2263 14.1667 7.91666Z" fill="currentColor" />
                                            <path d="M13.5355 12.4751C13.982 12.3635 14.2535 11.9111 14.1419 11.4646C14.0303 11.0181 13.5779 10.7466 13.1314 10.8583L6.46466 12.5249C6.01817 12.6365 5.74671 13.0889 5.85833 13.5354C5.96996 13.9819 6.4224 14.2534 6.8689 14.1418L13.5355 12.4751Z" fill="currentColor" />
                                            <path fill-rule="evenodd" clip-rule="evenodd" d="M9.99992 19.1667C15.0625 19.1667 19.1666 15.0626 19.1666 10C19.1666 4.9374 15.0625 0.833344 9.99992 0.833344C4.93731 0.833344 0.833252 4.9374 0.833252 10C0.833252 15.0626 4.93731 19.1667 9.99992 19.1667ZM9.99992 17.4943C5.86093 17.4943 2.50561 14.139 2.50561 10C2.50561 5.86102 5.86093 2.5057 9.99992 2.5057C14.1389 2.5057 17.4943 5.86102 17.4943 10C17.4943 14.139 14.1389 17.4943 9.99992 17.4943Z" fill="currentColor" />
                                        </g>
                                        <defs>
                                            <clipPath id="clip0_23_149">
                                                <rect width="20" height="20" fill="white" />
                                            </clipPath>
                                        </defs>
                                    </svg>
                                </button>
                            </div>
                            <div class="comment-reaction">
                                <span><?= count($reactions['dubious']) ?? 0 ?></span>
                                <button type="submit" name="reaction" value="dubious" data-comment-id="<?= $comment['comment_id'] ?>">
                                    <svg class="react-svg-gray 
                                    <?php if (isset($isUser)) {
                                        if (in_array($isUser, $reactions['dubious'])) {
                                            echo "react-svg-red";
                                        }
                                    } ?>" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_23_361)">
                                            <path d="M15 3L10 1.5L7 2.5L3.5 4.5L2 8V13.5L5.5 17.5L11 18.5L15 16.8209L18 13V7.5L15 3Z" stroke="#8D8D8D" />
                                            <path fill-rule="evenodd" clip-rule="evenodd" d="M10 15.8333C11.3807 15.8333 12.5 14.7141 12.5 13.3333C12.5 11.9526 11.3807 10.8333 10 10.8333C8.61925 10.8333 7.5 11.9526 7.5 13.3333C7.5 14.7141 8.61925 15.8333 10 15.8333ZM10 14.2526C9.49233 14.2526 9.08075 13.841 9.08075 13.3333C9.08075 12.8256 9.49233 12.4141 10 12.4141C10.5077 12.4141 10.9192 12.8256 10.9192 13.3333C10.9192 13.841 10.5077 14.2526 10 14.2526Z" fill="currentColor" />
                                            <path d="M8.33325 7.91669C8.33325 8.60702 7.77361 9.16669 7.08325 9.16669C6.39289 9.16669 5.83325 8.60702 5.83325 7.91669C5.83325 7.22633 6.39289 6.66669 7.08325 6.66669C7.77361 6.66669 8.33325 7.22633 8.33325 7.91669Z" fill="currentColor" />
                                            <path d="M12.9167 9.16669C13.6071 9.16669 14.1667 8.60702 14.1667 7.91669C14.1667 7.22633 13.6071 6.66669 12.9167 6.66669C12.2264 6.66669 11.6667 7.22633 11.6667 7.91669C11.6667 8.60702 12.2264 9.16669 12.9167 9.16669Z" fill="currentColor" />
                                            <path fill-rule="evenodd" clip-rule="evenodd" d="M9.99992 19.1666C15.0625 19.1666 19.1666 15.0626 19.1666 9.99998C19.1666 4.93737 15.0625 0.833313 9.99992 0.833313C4.93731 0.833313 0.833252 4.93737 0.833252 9.99998C0.833252 15.0626 4.93731 19.1666 9.99992 19.1666ZM9.99992 17.4943C5.86093 17.4943 2.50561 14.139 2.50561 9.99998C2.50561 5.86099 5.86093 2.50567 9.99992 2.50567C14.1389 2.50567 17.4943 5.86099 17.4943 9.99998C17.4943 14.139 14.1389 17.4943 9.99992 17.4943Z" fill="currentColor" />
                                        </g>
                                        <defs>
                                            <clipPath id="clip0_23_361">
                                                <rect width="20" height="20" fill="white" />
                                            </clipPath>
                                        </defs>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </section>

                </div>
            <?php }
        } else { ?>
            Ce film n'a pas reçu de critiques.
        <?php } ?>
    </section>

</main>
<?php require_once __DIR__ . "/../../../src/views/footer.html.php" ?>